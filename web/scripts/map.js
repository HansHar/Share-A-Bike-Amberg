/*
VARIABLES
*/
const Debug = false;

// map
var map;
const StartPos = [49.445, 11.8577];

// zones
const bikeZoneWeight = 3;
const bikeZoneColor = 'cornflowerblue';
const bikeZoneOpacity = 0.15;
const loadingZoneWeight = 8;
const loadingZoneColor = 'orange';
const loadingZoneOpacity = 0.5;



/*
MAP
*/
map = L.map('map', {
    zoomControl: false,
    // minZoom: 13,
})
.setView(StartPos, 13);

// tile provider (look of the map)
// -> https://leaflet-extras.github.io/leaflet-providers/preview/index.html
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);



/*
BIKE ZONES
*/
var zone = L.polygon(
    [
        [49.44361706972051, 11.843261718750002],
        [49.445393553269554, 11.843909024973984],
        [49.445533064947355, 11.842353343745346],
        [49.44617481355221, 11.843404769679184],
        [49.44834646558171, 11.835365295410158],
        [49.45111785568724, 11.837854385375978],
        [49.45318234690487, 11.840772628784181],
        [49.45383329485718, 11.845006942967302],
        [49.454949185033584, 11.846680641392595],
        [49.45439124312102, 11.848311424473653],
        [49.45454002853585, 11.849734783609167],
        [49.45505147341152, 11.850614547511215],
        [49.453823995381846, 11.851816177149887],
        [49.455590811232625, 11.855628490666277],
        [49.456371907311954, 11.861128806849594],
        [49.456102245143576, 11.86223030090332],
        [49.45381469675612, 11.86128616333008],
        [49.45484689644219, 11.86326026916504],
        [49.4551537624273, 11.864719390869142],
        [49.45373100393699, 11.865577697753908],
        [49.453117252230165, 11.866607666015627],
        [49.45239189939582, 11.86677932739258],
        [49.45226635646945, 11.866936683545648],
        [49.45262903515723, 11.868159770856439],
        [49.451429395409946, 11.869683265576898],
        [49.45148519325851, 11.87021255493164],
        [49.45087141343105, 11.871414184570314],
        [49.450885363057914, 11.872658729553224],
        [49.4503971237552, 11.873431205749512],
        [49.44949968101773, 11.872229576110842],
        [49.44942993087203, 11.874589920043947],
        [49.44864872246017, 11.874182224273682],
        [49.44824416321139, 11.874568462371826],
        [49.447504787682334, 11.874275207410392],
        [49.445984150130656, 11.874833106885491],
        [49.444440212704734, 11.875662803649902],
        [49.44424489189116, 11.872143745422365],
        [49.44410537654793, 11.869955062866213],
        [49.44432860090654, 11.868882179260256],
        [49.4435473112053, 11.868109703063965],
        [49.443658924781964, 11.866564750671388],
        [49.439626723132875, 11.86964035023266],
        [49.439947637137976, 11.86863183964306],
        [49.440147625679174, 11.864583492060776],
        [49.44008716431124, 11.861550807843743],
        [49.439868572131324, 11.859776973506088],
        [49.439952288617874, 11.859090327998276],
        [49.4397476477812, 11.858518123954129],
        [49.43771049753481, 11.85873270067532],
        [49.437501196482955, 11.85776710542996],
        [49.43759887041833, 11.857402325003934],
        [49.4375151499142, 11.857166290610623],
        [49.43855234357095, 11.852188110351562],
        [49.43878954585229, 11.851952075958254],
        [49.43968253441506, 11.846780776977539],
        [49.44140335082602, 11.842324733624993],
        [49.44227768888891, 11.842467784881592],
    ], {
        weight: bikeZoneWeight,
        color: bikeZoneColor,
        fillOpacity: bikeZoneOpacity
    })
    .addTo(map);

var loadingZone1 = L.polygon(
    [
        [49.44436696749083, 11.848441958454714],
        [49.444639020590934, 11.848409771946535],
        [49.44473784290674, 11.84831947089606],
        [49.44497152786785, 11.848327517523105],
        [49.4449819913475, 11.847915351390839],
        [49.44522788247689, 11.848044097423553],
        [49.44513952459481, 11.848420500741668],
        [49.44496338962205, 11.84880137446271],
    ], {
        weight: loadingZoneWeight,
        color: loadingZoneColor,
        fillOpacity: loadingZoneOpacity
    })
    .addTo(map);

var loadingZone2 = L.polygon(
    [
        [49.44552143884744, 11.858399212374026],
        [49.44555457282045, 11.858358979238803],
        [49.445734193442256, 11.858825683607394],
        [49.445681876824196, 11.858914196504886],
    ], {
        weight: loadingZoneWeight,
        color: loadingZoneColor,
        fillOpacity: loadingZoneOpacity
    })
    .addTo(map);

var loadingZone3 = L.polygon(
    [
        [49.44464308982074, 11.857973635278542],
        [49.44476342050817, 11.8579119444712],
        [49.44484189688432, 11.858341097913582],
        [49.444749469139246, 11.858319640241463],
    ], {
        weight: loadingZoneWeight,
        color: loadingZoneColor,
        fillOpacity: loadingZoneOpacity
    })
    .addTo(map);

var loadingZone4 = L.polygon(
    [
        [49.44720136115949, 11.863077878952028],
        [49.44725193232383, 11.863174438476564],
        [49.44688747000727, 11.86375379562378],
        [49.446838642314056, 11.86364382505417],
    ], {
        weight: loadingZoneWeight,
        color: loadingZoneColor,
        fillOpacity: loadingZoneOpacity
    })
    .addTo(map);



/*
ICONS
*/
const BikesPos = [
    // oth (loading zone)
    [49.44474598118996, 11.848388314274416],
    [49.44485759203804, 11.848388314274416],
    [49.4449413000074, 11.84838294985639],
    [49.445018032187086, 11.848254203823675],
    [49.44503198347959, 11.848093271282778],

    // church (loading zone)
    [49.444759547271495, 11.857951270011862],
    [49.44471089689273, 11.858117776579995],
    [49.44475439390149, 11.858238559352978],

    // town hall (loading zone)
    [49.44561924488244, 11.858651769602439],
    [49.44558612750254, 11.858547256345867],
    [49.44565063054495, 11.85876433424992],
    [49.445692497806846, 11.858863630767688],

    // train station (loading zone)
    [49.44720194245527, 11.863158345222475],
    [49.44716532192484, 11.863206624984743],
    [49.447128701367056, 11.863268315792084],
    [49.44709033694384, 11.863338053226473],
    [49.44704150945268, 11.863405108451843],
    [49.44700314496124, 11.863474845886232],
    [49.446895026687436, 11.863665282726288],

    // random bikes
    [49.4444471885401, 11.84703826904297],
    [49.444673899297214, 11.84779465198517],
    [49.4451366181532, 11.846507191617095],
    [49.4488300763739, 11.843247413853536],
    [49.45287082002585, 11.849091053118173],
    [49.44500548742323, 11.857375350143268],
    [49.445031633034624, 11.8575013020166],
    [49.444177459382914, 11.8455040454046],
    [49.44063131649379, 11.847145557403566],
    [49.44084060418699, 11.853432655334474],
    [49.43885931156186, 11.856136322021486],
    [49.44190098143812, 11.8637752532959],
];



/*
DEBUG
*/
// uncomment event if you want to localize specific points
// -> useful for zone & bike creation
if (Debug)
{
    map.on('click', determinePosition);
}

var xlng = 0.000256;
var xlat = 0.000200;
function determinePosition(e)
{
    console.log("[" + e.latlng.lat + ", " + e.latlng.lng + "],");
    L.polygon([
      [e.latlng.lat-xlat,e.latlng.lng-xlng],
      [e.latlng.lat+xlat,e.latlng.lng-xlng],
      [e.latlng.lat-xlat,e.latlng.lng+xlng],
      [e.latlng.lat+xlat,e.latlng.lng+xlng],
    ]).addTo(map);
    
      L.polyline([
      [e.latlng.lat,e.latlng.lng-xlng],
      [e.latlng.lat,e.latlng.lng+xlng]
    ]).addTo(map);
}